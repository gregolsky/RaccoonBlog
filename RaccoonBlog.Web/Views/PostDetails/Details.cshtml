@using RaccoonBlog.Web.Infrastructure.Common
@model PostViewModel
@{
    ViewBag.Title = @Model.Post.Title;
}
@{
    ViewBag.CurrentUrl = Url.Action("Details", new { Model.Post.Id, Model.Post.Slug });
}

<article class="article-body">
    @Html.Partial("NextPrevNav")
    <time>
        <span>@Model.Post.PublishedAt.ToString("MMM dd")</span>
        @Model.Post.PublishedAt.ToString("yyyy")
    </time>
    <a href="@Url.Action("Details", new { Model.Post.Id, Model.Post.Slug })">
        @if (Model.SeriesInfo == null)
        {
            <h2>@Model.Post.Title</h2>
        }
        else
        {
            <h2>
                <span class="seriesTitle">
                    @Html.Raw(TitleConverter.ToSeriesTitle(Model.Post.Title))
                </span>
                @Html.Raw(TitleConverter.ToPostTitle(Model.Post.Title))
            </h2>
        }
    </a>
	<div class="clearfix"></div>
	<div class="timetoread">
		@{
			var timeToRead = PostHelper.CalculateTimeToRead(@Model.Post.Body);
		}
		<div>
			<span class="glyphicon glyphicon-time" aria-hidden="true"></span>
			time to read <strong class="force">@timeToRead.TimeToReadInMinutes min</strong> | <strong class="force">@timeToRead.WordCount words</strong>
		</div>
	</div>
    <hr />
    <div class="articleContent">
        @Model.Post.Body
    </div>

    <div class="postData">

        <a href='@string.Format("http://twitter.com/intent/tweet?status={0}+{1} via @{2}", Model.Post.Title, Request.Url.OriginalString, Model.Post.Author.TwitterNick)'>
            <span class="socicon twitter">a</span><span>Tweet</span>
        </a>
        <a style='text-decoration:none;' type="icon_link" onclick="window.open('@string.Format("http://www.facebook.com/sharer/sharer.php?u={0}&title={1}", Request.Url.OriginalString, Model.Post.Title)','sharer','toolbar=0,status=0,width=580,height=325');" href="javascript: void(0)">
            <span class="socicon facebook">b</span><span>share</span>
        </a>
        <a style='text-decoration:none;' type="icon_link" onclick="popUp=window.open('@string.Format("https://plus.google.com/share?url={0}", Request.Url.OriginalString)', 'popupwindow', 'scrollbars=yes,width=600,height=400');popUp.focus();return false" href="javascript: void(0)">
            <span class="socicon gplus">c</span><span>share</span>
        </a>
        <a href="#comments">
            <span class="glyphicon glyphicon-comment" aria-hidden="true"></span><span>@Model.Comments.Count comments</span>
        </a>
        @if (Model.Post.Tags.Count > 0)
        {
            <div class="tags pull-right-lg">
                <span class="glyphicon glyphicon-tag" aria-hidden="true"></span> Tags:
                <ul>
                    @foreach (var tag in Model.Post.Tags)
                    {
                        <li><a href="@Url.Action("Tag", "Posts", new {tag.Slug})">@tag.Name</a></li>
                    }
                </ul>
            </div>
        }


        <div class="clearfix"></div>
        <hr style="margin: 0;" />
    </div>

    @Html.Partial("NextPrevNav")

    @if (Model.SeriesInfo != null)
    {
        @Html.Partial("MoreInSeries")
    }
    <hr />
</article>

@Html.Partial("Comments")
@Html.Partial("MarkdownHelp")

@section Style {
    <link rel="canonical" href="@Url.AbsoluteAction("Details", new { Model.Post.Id, Model.Post.Slug })">
}
@section Script {
    <script type="text/javascript">
        window.twttr = (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0], t = window.twttr || {};
            if (d.getElementById(id)) return;
            js = d.createElement(s);
            js.id = id;
            js.src = "https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js, fjs);
            t._e = [];
            t.ready = function (f) { t._e.push(f); };
            return t;
        }(document, "script", "twitter-wjs"));
    </script>
}